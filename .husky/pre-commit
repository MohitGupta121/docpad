#!/bin/sh

run_commands_in_directory() {
  local directory=$1

  # Change to the specified directory
  if cd "$directory"; then
    echo "Running commands in $directory directory..."

    # Run prettier on all files
    yarn format

    # Run lint on all files
    yarn lint

  else
    echo "Failed to change to $directory directory."
    exit 1
  fi

  if [ $? -eq 0 ]; then
    printf "#######################################################################\n"
    printf "##\n"
    printf "##            âœ…ğŸˆâ€â¬›ğŸˆâœ… LINT CHECK PASSED âœ…ğŸˆğŸˆâ€â¬›âœ…\n"
    printf "##\n"
    printf "#######################################################################\n"
  else
    printf "#######################################################################\n"
    printf "##\n"
    printf "##      ğŸ¤ªğŸ˜‚âŒğŸ¤¬ Failed Lint check. ğŸ¤®ğŸ˜‚âŒğŸ¤¯\n"
    printf "##   ESLint Check Failed. Make the required changes listed above,\n"
    printf "##           add changes and try to commit again.\n"
    printf "##\n"
    printf "#######################################################################\n"
    exit 1
  fi

  # Run type-check on all files
  yarn type-check

  if [ $? -eq 0 ]; then
    printf "#######################################################################\n"
    printf "##\n"
    printf "##            âœ…ğŸˆğŸˆâ€â¬›âœ… TYPE CHECK PASSED âœ…ğŸˆâ€â¬›ğŸˆâœ…\n"
    printf "##\n"
    printf "#######################################################################\n"
  else
    printf "#######################################################################\n"
    printf "##\n"
    printf "##            ğŸ¤®ğŸ˜‚âŒğŸ¤¯ Failed Type check. ğŸ¤ªğŸ˜‚âŒğŸ¤¬\n"
    printf "##           Are you seriously trying to write that?\n"
    printf "##             Make the changes required above.\n"
    printf "##\n"
    printf "#######################################################################\n"
    exit 1
  fi

  # Return to the previous directory
  cd -
}

# Get the list of changed files
changed_files=$(git diff --name-only --cached)

# Check if there are changes in either frontend/ or localAdmin/frontend/
if echo "$changed_files" | grep -E '^(frontend/|localAdmin/frontend/)' | grep -qE '^(frontend/.*|localAdmin/frontend/.*)$'; then
  run_commands_in_directory frontend
  run_commands_in_directory localAdmin/frontend/


# Success
printf "##\n"
printf "#######################################################################\n"
printf "##\n"
printf "##   âœ…âœ…âœ…âœ… You win this time... I am committing this now. âœ…âœ…âœ…âœ…\n"
printf "##\n"
printf "#######################################################################\n"
fi
